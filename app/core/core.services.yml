parameters:
 db.params:
    driver: pdo_mysql
    dbname: ntc_doctrine
    host: localhost
    user: root
    password: ~
 doctrine.dev:
    true
 doctrine.entities.path:
     -  'C:\wamp\www\application\app\data\model'
services:
  doctrine.setup:
    class: Doctrine\ORM\Tools\Setup
    factory: [Doctrine\ORM\Tools\Setup,createAnnotationMetadataConfiguration]
    arguments:
        - '%doctrine.entities.path%'
        - '%doctrine.dev%'
  entity.manager:
    class:  Doctrine\ORM\EntityManager
    factory: [Doctrine\ORM\EntityManager, create]
    arguments:
        - '%db.params%'
        - '@doctrine.setup'
    public: true

  smarty:
    class: app\core\template\SmartyTemplateEngine
    calls:
      - [init, []]

#symfony classes
  event.dispatcher:
    class: Symfony\Component\EventDispatcher\ContainerAwareEventDispatcher
    arguments: ['@service_container']
  argument_resolver:
    class: Symfony\Component\HttpKernel\Controller\ArgumentResolver
  request_stack:
    class: Symfony\Component\HttpFoundation\RequestStack
    tags:
    - { name: persist }
  http_kernel:
    class: Symfony\Component\HttpKernel\HttpKernel
    arguments: ['@event.dispatcher', '@controller_resolver', '@request_stack','@argument_resolver']
  request.context:
    class: Symfony\Component\Routing\RequestContext

  class.resolver:
    class: app\core\dependencyInjection\ClassResolver
    calls:
      - [setContainer, ['@service_container']]
  controller_resolver:
    class: app\core\controller\ControllerResolver
    arguments: ['@class.resolver']
  module.repository:
    class: app\core\repository\ModuleRepository
  component.repository:
    class: app\core\repository\ComponentRepository
  module_component.repository:
    class: app\core\repository\ModuleComponentRepository
    arguments: ['@module.repository']
  component.initializer:
    class: app\core\component\ComponentInitializer
    arguments: ['@class.resolver','@component.target.resolver']
  context.admin:
    class: app\core\routing\AdminContext
    arguments: ['@current.route.match']
  url.matcher:
    class:  app\core\routing\UrlMatcher
  route.match:
    class: app\core\routing\RouteMatch
    arguments: ['@route.manager']
  current.route.match:
    class: app\core\routing\CurrentRouteMatch
    arguments: ['@request_stack']
  router.routes:
    class: app\core\routing\RouteManager
    arguments: ['@module.repository']
  url.generator:
    class: app\core\routing\UrlGenerator
    arguments: ['@router.provider','@request.context']
  router.provider:
    class: app\core\routing\RouteProvider
    arguments: ['@entity.manager']
  router.dumper:
    class: app\core\routing\Dumper
    arguments: ['@entity.manager']
  router.builder:
    class: app\core\routing\RouteBuilder
    arguments: ['@module.manager','@router.dumper','@event.dispatcher']
  router.access:
    class: app\core\routing\AccessAwareRouter
    arguments: ['@router.no_access_checks']
#    arguments: ['@router.no_access_checks', '@access_manager', '@current_user']
  router.matcher:
    class: \Symfony\Cmf\Component\Routing\NestedMatcher\NestedMatcher
    arguments: ['@router.provider','@url.matcher']
  router.dynamic:
    class: Symfony\Cmf\Component\Routing\DynamicRouter
    arguments: ['@request.context', '@router.matcher', '@url.generator']
    tags:
      - { name: service_collector, tag: non_lazy_route_enhancer, call: addRouteEnhancer }
  router.no_access_checks:
    class: Symfony\Cmf\Component\Routing\ChainRouter
    calls:
      - [setContext, ['@request.context']]
      - [add, ['@router.dynamic']]
  template.engine:
    class: app\core\template\SmartyTemplateEngine
#    handlers
  theme.handler:
    class: app\core\theme\ThemeHandler
#    managers
  component.manager:
    class: app\core\component\ComponentManager
    arguments: ['@component.initializer','@theme.manager']
  theme.repository:
    class: app\core\repository\ThemeRepository
  theme.manager:
    class: app\core\theme\ThemeManager
    arguments: ['@theme.repository','@active.theme.resolver']
  view.manager:
    class: app\core\view\ViewManager
    arguments: ['@template.engine','@theme.manager']
  cache.manager:
    class: app\core\cache\CacheManager
  route.manager:
    class: app\core\routing\RouteManager
    arguments: ['@module.repository']
  link.manager:
    class: app\core\view\link\LinkManager
    arguments: ['@route.manager','@cache.manager']
  block.manager:
    class: app\core\view\block\BlockManager
    arguments: ['@theme.manager','@component.manager']
  module.manager:
    class: app\core\module\ModuleManager
    arguments: ['@module.repository']

#    subscribers
  response.handler:
    class: app\core\event\subscriber\DefaultResponseHandlerSubscriber
    arguments: ['@block.manager','@current.route.match']
    tags:
      - { name: event_subscriber }
  router.handler:
    class: Symfony\Component\HttpKernel\EventListener\RouterListener
    arguments: ['@router.no_access_checks', '@request_stack', '@request.context', NULL]
    tags:
      - { name: event_subscriber }

  active.theme.resolver:
    class: app\core\theme\ActiveThemeResolver
    tags:
      - {name : 'resolver_collector',tag: 'theme'}
  front.theme.resolver:
    class: app\core\theme\DefaultThemeResolver
    tags:
      - { name: 'resolver',tag: 'theme' ,priority: 20}
  component.target.resolver:
    class: app\core\component\ComponentTargetResolver
    tags:
      - {name : 'resolver_collector', tag: 'component_target'}
  front.target.resolver:
    class: app\core\component\DefaultTargetResolver
    arguments: ['@component.repository']
    tags:
      - { name: 'resolver' ,tag: 'component_target',priority: 20}

#   core argument resolvers
  default.value_resolver:
    class: Symfony\Component\HttpKernel\Controller\ArgumentResolver\DefaultValueResolver
    tags:
      - { name : argument.value_resolver}
  request.value_resolver:
    class: Symfony\Component\HttpKernel\Controller\ArgumentResolver\RequestValueResolver
    tags:
      - { name : argument.value_resolver}
  request_attribute.value_resolver:
    class: Symfony\Component\HttpKernel\Controller\ArgumentResolver\RequestAttributeValueResolver
    tags:
      - { name : argument.value_resolver}
  variadic.value_resolver:
    class: Symfony\Component\HttpKernel\Controller\ArgumentResolver\VariadicValueResolver
    tags:
      - { name : argument.value_resolver}
  route_match.value_resolver:
    class: app\core\controller\argument\resolver\RouteMatchResolver
    tags:
      - { name : argument.value_resolver}